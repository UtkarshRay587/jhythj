<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProPyQuest - Complete Python Learning Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1000px;
            width: 100%;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            font-size: 3.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }

        .game-subtitle {
            color: #666;
            font-size: 1.2em;
            margin-top: 10px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .minigame-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .minigame-card {
            background: white;
            border: 3px solid #667eea;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .minigame-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .minigame-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #ccc;
        }

        .minigame-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .minigame-name {
            font-size: 1.3em;
            margin: 10px 0;
            color: #333;
            font-weight: bold;
        }

        .minigame-desc {
            color: #666;
            font-size: 0.9em;
        }

        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            line-height: 1.6;
        }

        .code-line {
            padding: 5px 10px;
            border-radius: 5px;
            margin: 2px 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .code-line:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .code-line.error {
            background: rgba(224, 108, 117, 0.3);
            border-left: 3px solid #e06c75;
        }

        .code-line.correct {
            background: rgba(152, 195, 121, 0.3);
            border-left: 3px solid #98c379;
        }

        .quiz-question {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .option {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .option:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .option.selected {
            background: #d4e3ff;
            border-color: #667eea;
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .option.wrong {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .explanation {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #ffc107;
        }

        .timer {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }

        .timer.warning {
            color: #f5576c;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .grid-map {
            display: grid;
            gap: 5px;
            margin: 20px auto;
            width: fit-content;
        }

        .grid-cell {
            width: 40px;
            height: 40px;
            border: 2px solid #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .grid-cell:hover {
            background: #f0f4ff;
            transform: scale(1.1);
        }

        .grid-cell.found {
            background: #98c379;
            color: white;
        }

        .grid-cell.obstacle {
            background: #e06c75;
        }

        .snake-game {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            color: white;
        }

        .snake-canvas {
            border: 3px solid #667eea;
            background: #2d2d2d;
            display: block;
            margin: 20px auto;
        }

        .story-choice {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            cursor: pointer;
            border-left: 5px solid #f5576c;
            transition: all 0.3s;
        }

        .story-choice:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .battle-screen {
            text-align: center;
        }

        .battle-enemy {
            font-size: 5em;
            margin: 20px 0;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .health-bar {
            background: #e9ecef;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .health-fill {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .streak-display {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
            font-weight: bold;
        }

        .leaderboard-entry {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 5px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mentor-message {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
        }

        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .difficulty-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .difficulty-btn.active {
            background: #667eea;
            color: white;
        }

        .progress-bar-container {
            background: #e9ecef;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .draggable-code {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid #667eea;
            cursor: move;
            user-select: none;
        }

        .drop-zone {
            min-height: 50px;
            background: #f0f4ff;
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
        }

        .hint-box {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">üéÆ ProPyQuest</h1>
            <p class="game-subtitle">Master Python Through 10 Epic Mini-Games</p>
        </div>

        <!-- Main Menu -->
        <div id="mainMenu" class="screen active">
            <div class="mentor-message">
                <span style="font-size: 2em;">ü§ñ</span>
                <strong>Pyra says:</strong> Welcome to ProPyQuest! Choose from 10 exciting mini-games to master Python. Your journey awaits!
            </div>
            <div class="stats-bar">
                <div class="stat-item">‚≠ê Total XP: <span id="totalXP">0</span></div>
                <div class="stat-item">üèÜ Rank: <span id="playerRank">Beginner</span></div>
                <div class="stat-item">üî• Streak: <span id="streakCount">0</span> days</div>
                <div class="stat-item">üéØ Games Won: <span id="gamesWon">0</span></div>
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showMiniGames()">üéÆ Play Mini-Games</button>
                <button class="btn btn-secondary" onclick="showDailyQuiz()">üìÖ Daily Quiz</button>
                <button class="btn btn-success" onclick="showLeaderboard()">üèÜ Leaderboard</button>
                <button class="btn btn-danger" onclick="showStats()">üìä My Stats</button>
            </div>
        </div>

        <!-- Mini Games Selection -->
        <div id="miniGamesMenu" class="screen">
            <h2 style="color: #667eea; margin-bottom: 20px;">üéÆ Choose Your Challenge</h2>
            <div class="minigame-grid" id="miniGameGrid"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="showScreen('mainMenu')">‚Üê Back to Menu</button>
            </div>
        </div>

        <!-- 1. Bug Hunter Game -->
        <div id="bugHunterGame" class="screen">
            <h2 style="color: #667eea;">üêõ Bug Hunter</h2>
            <div class="stats-bar">
                <div class="stat-item">‚è±Ô∏è Time: <span id="bugTimer">60</span>s</div>
                <div class="stat-item">üéØ Score: <span id="bugScore">0</span></div>
                <div class="stat-item">üìä Level: <span id="bugLevel">Easy</span></div>
            </div>
            <div class="difficulty-selector">
                <div class="difficulty-btn active" onclick="setBugDifficulty('easy')">Easy</div>
                <div class="difficulty-btn" onclick="setBugDifficulty('medium')">Medium</div>
                <div class="difficulty-btn" onclick="setBugDifficulty('hard')">Hard</div>
            </div>
            <p style="text-align: center; margin: 20px 0;">üéØ Find the bug in the code! Click on the line with the error.</p>
            <div class="code-block" id="bugCode"></div>
            <div id="bugFeedback"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="nextBugChallenge()">Next Challenge ‚Üí</button>
                <button class="btn btn-secondary" onclick="showMiniGames()">‚Üê Back</button>
            </div>
        </div>

        <!-- 2. Output Predictor -->
        <div id="outputPredictorGame" class="screen">
            <h2 style="color: #667eea;">üîÆ Output Predictor</h2>
            <div class="stats-bar">
                <div class="stat-item">‚è±Ô∏è Time: <span id="outputTimer">30</span>s</div>
                <div class="stat-item">üéØ Score: <span id="outputScore">0</span></div>
                <div class="stat-item">‚úÖ Correct: <span id="outputCorrect">0</span></div>
            </div>
            <p style="text-align: center; margin: 20px 0;">üîÆ What will this code output?</p>
            <div class="code-block" id="outputCode"></div>
            <div id="outputOptions"></div>
            <div class="hint-box" id="outputHint" style="display: none;"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="useHint()">üí° Use Hint</button>
                <button class="btn btn-secondary" onclick="showMiniGames()">‚Üê Back</button>
            </div>
        </div>

        <!-- 3. Code Scramble -->
        <div id="codeScrambleGame" class="screen">
            <h2 style="color: #667eea;">üîÑ Code Scramble</h2>
            <div class="stats-bar">
                <div class="stat-item">‚è±Ô∏è Time: <span id="scrambleTimer">60</span>s</div>
                <div class="stat-item">üéØ Score: <span id="scrambleScore">0</span></div>
            </div>
            <p style="text-align: center; margin: 20px 0;">üìù Drag and drop the lines to create correct Python code!</p>
            <div id="scrambleCode"></div>
            <div id="dropZone" class="drop-zone">Drop lines here in correct order</div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="checkScramble()">‚úÖ Check Answer</button>
                <button class="btn" onclick="resetScramble()">üîÑ Reset</button>
                <button class="btn btn-secondary" onclick="showMiniGames()">‚Üê Back</button>
            </div>
        </div>

        <!-- 4. Treasure Hunt -->
        <div id="treasureHuntGame" class="screen">
            <h2 style="color: #667eea;">üíé Treasure Hunt</h2>
            <div class="stats-bar">
                <div class="stat-item">üéØ Treasures: <span id="treasuresFound">0</span>/3</div>
                <div class="stat-item">üë£ Moves: <span id="movesCount">0</span></div>
                <div class="stat-item">üìç Level: <span id="treasureLevel">1</span></div>
            </div>
            <p style="text-align: center; margin: 20px 0;">üó∫Ô∏è Use loops and logic to find hidden treasures!</p>
            <div class="grid-map" id="treasureGrid"></div>
            <div class="input-group">
                <input type="text" id="treasureCode" placeholder="Write Python code to find treasure (e.g., for i in range(5):)" />
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="executeTreasureCode()">‚ñ∂Ô∏è Run Code</button>
                <button class="btn btn-secondary" onclick="showMiniGames()">‚Üê Back</button>
            </div>
        </div>

        <!-- 5. Daily Quiz -->
        <div id="dailyQuizGame" class="screen">
            <h2 style="color: #667eea;">üìÖ Daily Python Quiz</h2>
            <div class="streak-display">
                üî• Current Streak: <span id="quizStreak">0</span> days
            </div>
            <div id="quizQuestion" class="quiz-question"></div>
            <div id="quizExplanation"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button id="quizNextBtn" class="btn" onclick="nextQuizQuestion()" style="display: none;">Next Question ‚Üí</button>
                <button class="btn btn-secondary" onclick="showScreen('mainMenu')">‚Üê Back</button>
            </div>
        </div>

        <!-- 6. Snake Logic Challenge -->
        <div id="snakeGame" class="screen">
            <h2 style="color: #667eea;">üêç Snake Logic Challenge</h2>
            <div class="snake-game">
                <div class="stats-bar">
                    <div class="stat-item">üìè Length: <span id="snakeLength">3</span></div>
                    <div class="stat-item">üéØ Score: <span id="snakeScore">0</span></div>
                </div>
                <canvas id="snakeCanvas" class="snake-canvas" width="400" height="400"></canvas>
                <div id="snakeQuestion" style="display: none;">
                    <div class="quiz-question" id="snakeQuizContent"></div>
                </div>
                <p style="text-align: center; color: white; margin-top: 15px;">
                    Use Arrow Keys to move. Answer Python questions when you eat food!
                </p>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="startSnakeGame()">üéÆ Start Game</button>
                <button class="btn btn-secondary" onclick="showMiniGames()">‚Üê Back</button>
            </div>
        </div>

        <!-- 7. If/Else Adventure Story -->
        <div id="storyAdventureGame" class="screen">
            <h2 style="color: #667eea;">üìñ If/Else Adventure</h2>
            <div class="stats-bar">
                <div class="stat-item">üìç Chapter: <span id="storyChapter">1</span></div>
                <div class="stat-item">‚≠ê Decisions: <span id="storyDecisions">0</span></div>
            </div>
            <div id="storyContent"></div>
            <div id="storyChoices"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="restartStory()">üîÑ Restart Story</button>
                <button class="btn btn-secondary" onclick="showMiniGames()">‚Üê Back</button>
            </div>
        </div>

        <!-- 8. File Hacker Challenge -->
        <div id="fileHackerGame" class="screen">
            <h2 style="color: #667eea;">üíæ File Hacker Challenge</h2>
            <div class="stats-bar">
                <div class="stat-item">üìÇ Mission: <span id="fileMission">1</span>/10</div>
                <div class="stat-item">üéØ Score: <span id="fileScore">0</span></div>
            </div>
            <div id="fileMissionContent"></div>
            <div class="input-group">
                <textarea id="fileCode" rows="6" placeholder="Write your file handling code here..." style="font-family: 'Courier New', monospace;"></textarea>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="executeFileCode()">‚ñ∂Ô∏è Execute Code</button>
                <button class="btn" onclick="nextFileMission()">Next Mission ‚Üí</button>
                <button class="btn btn-secondary" onclick="showMiniGames()">‚Üê Back</button>
            </div>
        </div>

        <!-- 9. Function Builder -->
        <div id="functionBuilderGame" class="screen">
            <h2 style="color: #667eea;">‚öôÔ∏è Function Builder</h2>
            <div class="stats-bar">
                <div class="stat-item">üìä Level: <span id="funcLevel">1</span></div>
                <div class="stat-item">üéØ Score: <span id="funcScore">0</span></div>
                <div class="stat-item">‚úÖ Completed: <span id="funcCompleted">0</span></div>
            </div>
            <div id="functionContent"></div>
            <div class="input-group">
                <textarea id="functionCode" rows="8" placeholder="Complete the function..." style="font-family: 'Courier New', monospace;"></textarea>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="testFunction()">üß™ Test Function</button>
                <button class="btn" onclick="nextFunctionChallenge()">Next Challenge ‚Üí</button>
                <button class="btn btn-secondary" onclick="showMiniGames()">‚Üê Back</button>
            </div>
        </div>

        <!-- 10. Python RPG Battle -->
        <div id="rpgBattleGame" class="screen">
            <h2 style="color: #667eea;">‚öîÔ∏è Python RPG Battle</h2>
            <div class="battle-screen">
                <div id="enemyDisplay" class="battle-enemy">üêâ</div>
                <h3 id="enemyName">Code Dragon</h3>
                <div class="health-bar">
                    <div id="enemyHealth" class="health-fill" style="width: 100%;">100 HP</div>
                </div>
                <div style="margin: 30px 0;">
                    <h3>Your Hero</h3>
                    <div class="health-bar">
                        <div id="playerHealth" class="health-fill" style="width: 100%;">100 HP</div>
                    </div>
                </div>
                <div id="battleQuestion" class="quiz-question"></div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="showMiniGames()">‚Üê Back</button>
            </div>
        </div>

        <!-- Stats Screen -->
        <div id="statsScreen" class="screen">
            <h2 style="color: #667eea; margin-bottom: 20px;">üìä Your Statistics</h2>
            <div class="stats-bar">
                <div class="stat-item">‚≠ê Total XP: <span id="statsXP">0</span></div>
                <div class="stat-item">üèÜ Rank: <span id="statsRank">Beginner</span></div>
                <div class="stat-item">üî• Streak: <span id="statsStreak">0</span></div>
            </div>
            <div id="badgesDisplay" style="margin: 20px 0;"></div>
            <div id="gameStats"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-danger" onclick="resetProgress()">üîÑ Reset All Progress</button>
                <button class="btn btn-secondary" onclick="showScreen('mainMenu')">‚Üê Back</button>
            </div>
        </div>

        <!-- Leaderboard Screen -->
        <div id="leaderboardScreen" class="screen">
            <h2 style="color: #667eea; margin-bottom: 20px;">üèÜ Global Leaderboard</h2>
            <div id="leaderboardContent"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="showScreen('mainMenu')">‚Üê Back</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== GAME DATA ====================
        
        const MINIGAMES = {
            bugHunter: {
                name: "Bug Hunter",
                icon: "üêõ",
                description: "Find errors in Python code",
                xpReward: 20,
                unlockLevel: 0
            },
            outputPredictor: {
                name: "Output Predictor",
                icon: "üîÆ",
                description: "Predict code output",
                xpReward: 15,
                unlockLevel: 50
            },
            codeScramble: {
                name: "Code Scramble",
                icon: "üîÑ",
                description: "Arrange code in correct order",
                xpReward: 25,
                unlockLevel: 100
            },
            treasureHunt: {
                name: "Treasure Hunt",
                icon: "üíé",
                description: "Use loops to find treasure",
                xpReward: 30,
                unlockLevel: 150
            },
            dailyQuiz: {
                name: "Daily Quiz",
                icon: "üìÖ",
                description: "Test your Python knowledge",
                xpReward: 50,
                unlockLevel: 0
            },
            snakeGame: {
                name: "Snake Logic",
                icon: "üêç",
                description: "Play snake and answer questions",
                xpReward: 40,
                unlockLevel: 200
            },
            storyAdventure: {
                name: "If/Else Adventure",
                icon: "üìñ",
                description: "Make decisions in a story",
                xpReward: 35,
                unlockLevel: 250
            },
            fileHacker: {
                name: "File Hacker",
                icon: "üíæ",
                description: "Master file operations",
                xpReward: 45,
                unlockLevel: 300
            },
            functionBuilder: {
                name: "Function Builder",
                icon: "‚öôÔ∏è",
                description: "Complete Python functions",
                xpReward: 40,
                unlockLevel: 350
            },
            rpgBattle: {
                name: "RPG Battle",
                icon: "‚öîÔ∏è",
                description: "Battle monsters with code",
                xpReward: 60,
                unlockLevel: 400
            }
        };

        // Bug Hunter Database - 20+ buggy codes
        const BUG_CHALLENGES = {
            easy: [
                {
                    code: ["name = 'Alice'", "age = 25", "print(Name)", "print(age)"],
                    bugLine: 2,
                    explanation: "Python is case-sensitive! 'Name' should be 'name'"
                },
                {
                    code: ["x = 10", "y = 5", "print(x + y", "print('Done')"],
                    bugLine: 2,
                    explanation: "Missing closing parenthesis ')' in print statement"
                },
                {
                    code: ["fruit = 'apple'", "print('I like ' + fruit)", "print(fruit + 5)", "print(fruit)"],
                    bugLine: 2,
                    explanation: "Cannot concatenate string and integer. Use str(5) or '5'"
                },
                {
                    code: ["number = '10'", "result = number * 2", "print(result)", "# Should print 20"],
                    bugLine: 1,
                    explanation: "number is a string! Convert to int: number = int('10')"
                },
                {
                    code: ["x = 5", "if x = 5:", "    print('Five')", "print('Done')"],
                    bugLine: 1,
                    explanation: "Use == for comparison, not =. Assignment vs comparison!"
                },
                {
                    code: ["items = [1, 2, 3]", "print(items[3])", "print(items[0])"],
                    bugLine: 1,
                    explanation: "Index out of range! List has indices 0, 1, 2. No index 3!"
                },
                {
                    code: ["name = 'Bob'", "age = 30", "print('Name: ' name)", "print('Age:', age)"],
                    bugLine: 2,
                    explanation: "Missing + or comma for concatenation"
                }
            ],
            medium: [
                {
                    code: ["def greet():", "print('Hello')", "    print('World')", "greet()"],
                    bugLine: 1,
                    explanation: "Inconsistent indentation! Line 2 needs proper indent"
                },
                {
                    code: ["numbers = [1, 2, 3, 4]", "for num in numbers", "    print(num * 2)", "print('Done')"],
                    bugLine: 1,
                    explanation: "Missing colon ':' after for loop statement"
                },
                {
                    code: ["def add(a, b):", "    return a + b", "result = add(5)", "print(result)"],
                    bugLine: 2,
                    explanation: "Function needs 2 arguments but only 1 provided"
                },
                {
                    code: ["x = 10", "y = 0", "result = x / y", "print(result)"],
                    bugLine: 2,
                    explanation: "Division by zero error! Check if y != 0 before dividing"
                },
                {
                    code: ["data = {'name': 'Alice', 'age': 25}", "print(data['city'])", "print(data['name'])"],
                    bugLine: 1,
                    explanation: "KeyError! 'city' key doesn't exist in dictionary"
                },
                {
                    code: ["while True", "    print('Loop')", "    break", "print('Done')"],
                    bugLine: 0,
                    explanation: "Missing colon ':' after while statement"
                }
            ],
            hard: [
                {
                    code: ["class Dog:", "def __init__(self, name):", "    self.name = name", "dog = Dog('Buddy')"],
                    bugLine: 1,
                    explanation: "Method inside class needs proper indentation"
                },
                {
                    code: ["numbers = [1, 2, 3]", "squares = [x**2 for x in number]", "print(squares)"],
                    bugLine: 1,
                    explanation: "Variable name error: 'number' should be 'numbers'"
                },
                {
                    code: ["def factorial(n):", "    if n == 0:", "        return 1", "    return n * factorial(n)"],
                    bugLine: 3,
                    explanation: "Infinite recursion! Should be factorial(n-1)"
                },
                {
                    code: ["try:", "    x = int('abc')", "except ValueError", "    print('Error')"],
                    bugLine: 2,
                    explanation: "Missing colon ':' after except ValueError"
                },
                {
                    code: ["matrix = [[1, 2], [3, 4]]", "print(matrix[1][2])", "print(matrix[0][1])"],
                    bugLine: 1,
                    explanation: "Index out of range! Inner list has indices 0, 1 only"
                }
            ]
        };

        // Output Predictor Challenges
        const OUTPUT_CHALLENGES = [
            {
                code: ["x = 5", "y = 10", "z = x + y", "print(z)"],
                options: ["15", "510", "xy", "Error"],
                answer: "15",
                hint: "Numbers are added mathematically",
                explanation: "5 + 10 = 15"
            },
            {
                code: ["text = 'Hello'", "print(text * 3)"],
                options: ["HelloHelloHello", "Hello3", "15", "Error"],
                answer: "HelloHelloHello",
                hint: "Strings can be multiplied to repeat them",
                explanation: "String multiplication repeats the string"
            },
            {
                code: ["x = 10", "x += 5", "print(x)"],
                options: ["10", "15", "105", "Error"],
                answer: "15",
                hint: "+= adds to the existing value",
                explanation: "x += 5 means x = x + 5, so 10 + 5 = 15"
            },
            {
                code: ["nums = [1, 2, 3]", "print(len(nums))"],
                options: ["3", "[1, 2, 3]", "6", "123"],
                answer: "3",
                hint: "len() returns the number of items",
                explanation: "The list has 3 elements"
            },
            {
                code: ["x = 7", "print(x % 2)"],
                options: ["1", "3.5", "2", "0"],
                answer: "1",
                hint: "% is the modulo operator (remainder)",
                explanation: "7 divided by 2 gives remainder 1"
            },
            {
                code: ["a = 5", "b = 10", "print(a > b)"],
                options: ["True", "False", "5", "10"],
                answer: "False",
                hint: "Comparison returns True or False",
                explanation: "5 is not greater than 10, so False"
            },
            {
                code: ["text = 'Python'", "print(text[0])"],
                options: ["P", "Python", "0", "Error"],
                answer: "P",
                hint: "Index 0 gives the first character",
                explanation: "String indexing starts at 0"
            },
            {
                code: ["x = [1, 2]", "x.append(3)", "print(x)"],
                options: ["[1, 2, 3]", "[1, 2]", "3", "Error"],
                answer: "[1, 2, 3]",
                hint: "append() adds an item to the end",
                explanation: "append() modifies the list"
            }
        ];

        // Code Scramble Challenges
        const SCRAMBLE_CHALLENGES = [
            {
                correct: ["def greet():", "    name = input('Your name: ')", "    print('Hello, ' + name)", "greet()"],
                description: "Create a function that greets the user"
            },
            {
                correct: ["numbers = [1, 2, 3, 4, 5]", "total = 0", "for num in numbers:", "    total += num", "print(total)"],
                description: "Calculate sum of numbers in a list"
            },
            {
                correct: ["x = 10", "if x > 5:", "    print('Big')", "else:", "    print('Small')"],
                description: "Check if number is big or small"
            }
        ];

        // Daily Quiz Questions
        const DAILY_QUIZ = [
            {
                q: "What keyword is used to create a function in Python?",
                options: ["A) function", "B) def", "C) func", "D) define"],
                answer: "B",
                explanation: "'def' is short for 'define' and creates functions"
            },
            {
                q: "Which data type is mutable (can be changed)?",
                options: ["A) tuple", "B) string", "C) list", "D) integer"],
                answer: "C",
                explanation: "Lists can be modified after creation. Tuples and strings cannot."
            },
            {
                q: "What does 'elif' stand for?",
                options: ["A) else if", "B) element if", "C) end if", "D) error if"],
                answer: "A",
                explanation: "'elif' is short for 'else if' in Python"
            },
            {
                q: "Which symbol starts a comment in Python?",
                options: ["A) //", "B) /* */", "C) #", "D) --"],
                answer: "C",
                explanation: "# is used for single-line comments in Python"
            },
            {
                q: "What method adds an item to the end of a list?",
                options: ["A) add()", "B) append()", "C) insert()", "D) push()"],
                answer: "B",
                explanation: "append() adds items to the end of lists"
            },
            {
                q: "How do you start a while loop?",
                options: ["A) while (condition)", "B) while condition:", "C) loop while:", "D) repeat while:"],
                answer: "B",
                explanation: "Python uses 'while condition:' with a colon"
            },
            {
                q: "What does 'len()' function return?",
                options: ["A) Last element", "B) Length/size", "C) Type", "D) Value"],
                answer: "B",
                explanation: "len() returns the number of items in a collection"
            },
            {
                q: "Which is the correct way to import a module?",
                options: ["A) import module_name", "B) include module_name", "C) using module_name", "D) require module_name"],
                answer: "A",
                explanation: "Use 'import module_name' to import modules"
            },
            {
                q: "What does '==' operator do?",
                options: ["A) Assigns value", "B) Compares equality", "C) Adds numbers", "D) Creates variable"],
                answer: "B",
                explanation: "== checks if two values are equal, = assigns"
            },
            {
                q: "How do you create an empty dictionary?",
                options: ["A) dict = []", "B) dict = ()", "C) dict = {}", "D) dict = <>"],
                answer: "C",
                explanation: "{} creates an empty dictionary, [] creates a list"
            }
        ];

        // Story Adventure Data
        const STORY_DATA = {
            start: {
                text: "You wake up in a mysterious coding academy. A voice says: 'To escape, you must master Python!' There are two doors.",
                choices: [
                    { text: "Enter the BLUE door (if temperature > 20)", next: "blue_room", code: "if temperature > 20:" },
                    { text: "Enter the RED door (if age >= 18)", next: "red_room", code: "if age >= 18:" }
                ]
            },
            blue_room: {
                text: "The blue room is cold. You see a thermostat showing 15¬∞C. The condition 'if temperature > 20' evaluates to FALSE, so you can't proceed. You return.",
                choices: [
                    { text: "Try the RED door instead", next: "red_room", code: "if age >= 18:" }
                ]
            },
            red_room: {
                text: "The red room opens! You're 18 years old, so 'if age >= 18' is TRUE. You find a treasure chest with a lock.",
                choices: [
                    { text: "If chest_locked == True: try to open", next: "locked", code: "if chest_locked == True:" },
                    { text: "Else: take treasure", next: "open", code: "else:" }
                ]
            },
            locked: {
                text: "The chest is locked! The condition was TRUE. You need a key. You find a note: 'Use elif for multiple conditions!'",
                choices: [
                    { text: "Continue exploring", next: "puzzle", code: "elif found_key:" }
                ]
            },
            puzzle: {
                text: "You solved it! You've mastered if/elif/else logic. You escape with the treasure! üéâ",
                choices: []
            }
        };

        // File Hacker Missions
        const FILE_MISSIONS = [
            {
                title: "Mission 1: Create a File",
                description: "Write code to create a file called 'data.txt'",
                hint: "Use: file = open('data.txt', 'w')",
                solution: "file = open('data.txt', 'w')\nfile.close()"
            },
            {
                title: "Mission 2: Write to File",
                description: "Write 'Hello Python!' to a file",
                hint: "Use: file.write('Hello Python!')",
                solution: "file = open('data.txt', 'w')\nfile.write('Hello Python!')\nfile.close()"
            },
            {
                title: "Mission 3: Read from File",
                description: "Read contents from a file",
                hint: "Use: content = file.read()",
                solution: "file = open('data.txt', 'r')\ncontent = file.read()\nprint(content)\nfile.close()"
            },
            {
                title: "Mission 4: Append to File",
                description: "Add new text to existing file without erasing",
                hint: "Use mode 'a' for append",
                solution: "file = open('data.txt', 'a')\nfile.write('\\nNew line')\nfile.close()"
            },
            {
                title: "Mission 5: Use With Statement",
                description: "Open file using 'with' statement (safer)",
                hint: "with open('data.txt', 'r') as file:",
                solution: "with open('data.txt', 'r') as file:\n    content = file.read()\n    print(content)"
            },
            {
                title: "Mission 6: Read Line by Line",
                description: "Read and print each line separately",
                hint: "Use: for line in file:",
                solution: "with open('data.txt', 'r') as file:\n    for line in file:\n        print(line)"
            },
            {
                title: "Mission 7: Check if File Exists",
                description: "Check if a file exists before opening",
                hint: "Use: import os; os.path.exists('file.txt')",
                solution: "import os\nif os.path.exists('data.txt'):\n    print('File exists!')"
            },
            {
                title: "Mission 8: Write Multiple Lines",
                description: "Write a list of lines to a file",
                hint: "Use: file.writelines(list_of_lines)",
                solution: "lines = ['Line 1\\n', 'Line 2\\n']\nwith open('data.txt', 'w') as file:\n    file.writelines(lines)"
            },
            {
                title: "Mission 9: Read into List",
                description: "Read all lines into a list",
                hint: "Use: lines = file.readlines()",
                solution: "with open('data.txt', 'r') as file:\n    lines = file.readlines()\n    print(lines)"
            },
            {
                title: "Mission 10: Handle File Errors",
                description: "Use try/except to handle file errors",
                hint: "try: ... except FileNotFoundError:",
                solution: "try:\n    with open('missing.txt', 'r') as file:\n        content = file.read()\nexcept FileNotFoundError:\n    print('File not found!')"
            }
        ];

        // Function Builder Challenges
        const FUNCTION_CHALLENGES = [
            {
                description: "Complete a function that returns the sum of two numbers",
                incomplete: "def add(a, b):\n    # Complete this\n    return",
                solution: "def add(a, b):\n    return a + b",
                tests: [[2, 3, 5], [10, 20, 30]]
            },
            {
                description: "Complete a function that checks if a number is even",
                incomplete: "def is_even(num):\n    # Complete this\n    return",
                solution: "def is_even(num):\n    return num % 2 == 0",
                tests: [[4, true], [7, false]]
            },
            {
                description: "Complete a function that returns the maximum of three numbers",
                incomplete: "def max_of_three(a, b, c):\n    # Complete this\n    return",
                solution: "def max_of_three(a, b, c):\n    return max(a, b, c)",
                tests: [[1, 5, 3, 5], [10, 2, 8, 10]]
            }
        ];

        // RPG Battle Data
        const RPG_ENEMIES = [
            {
                name: "Bug Monster",
                emoji: "üêõ",
                hp: 100,
                question: {
                    q: "What prints? x = 5; print(x * 2)",
                    options: ["A) 10", "B) 52", "C) 25", "D) Error"],
                    answer: "A"
                }
            },
            {
                name: "Syntax Dragon",
                emoji: "üêâ",
                hp: 150,
                question: {
                    q: "Which creates a list?",
                    options: ["A) list = (1,2,3)", "B) list = {1,2,3}", "C) list = [1,2,3]", "D) list = <1,2,3>"],
                    answer: "C"
                }
            },
            {
                name: "Logic Beast",
                emoji: "üëæ",
                hp: 200,
                question: {
                    q: "What does 'and' operator return if one condition is False?",
                    options: ["A) True", "B) False", "C) None", "D) Error"],
                    answer: "B"
                }
            }
        ];

        // ==================== GAME STATE ====================
        let gameState = {
            totalXP: 0,
            rank: "Beginner",
            streak: 0,
            lastPlayed: null,
            gamesWon: 0,
            badges: [],
            gameProgress: {
                bugHunter: { played: 0, won: 0, highScore: 0 },
                outputPredictor: { played: 0, won: 0, highScore: 0 },
                codeScramble: { played: 0, won: 0, highScore: 0 },
                treasureHunt: { played: 0, won: 0, level: 1 },
                dailyQuiz: { played: 0, streak: 0, lastDate: null },
                snakeGame: { played: 0, highScore: 0 },
                storyAdventure: { completed: false, chapter: 0 },
                fileHacker: { mission: 1, completed: 0 },
                functionBuilder: { level: 1, completed: 0 },
                rpgBattle: { defeated: [] }
            }
        };

        // Current game states
        let currentBugChallenge = null;
        let currentOutputChallenge = null;
        let bugTimer = null;
        let outputTimer = null;
        let scrambleTimer = null;
        let currentScramble = null;
        let droppedLines = [];
        let currentQuizIndex = 0;
        let currentStoryNode = 'start';
        let snakeGameRunning = false;
        let currentEnemy = 0;

        // ==================== INITIALIZATION ====================
        function initGame() {
            loadGameState();
            updateMainStats();
            checkDailyStreak();
        }

        function loadGameState() {
            const saved = localStorage.getItem('propyquest_game_state');
            if (saved) {
                gameState = JSON.parse(saved);
            }
        }

        function saveGameState() {
            localStorage.setItem('propyquest_game_state', JSON.stringify(gameState));
        }

        function updateMainStats() {
            document.getElementById('totalXP').textContent = gameState.totalXP;
            document.getElementById('playerRank').textContent = gameState.rank;
            document.getElementById('streakCount').textContent = gameState.streak;
            document.getElementById('gamesWon').textContent = gameState.gamesWon;
            updateRank();
        }

        function updateRank() {
            const xp = gameState.totalXP;
            if (xp >= 1000) gameState.rank = "Python Master";
            else if (xp >= 700) gameState.rank = "Expert Coder";
            else if (xp >= 400) gameState.rank = "Advanced";
            else if (xp >= 200) gameState.rank = "Intermediate";
            else if (xp >= 50) gameState.rank = "Novice";
            else gameState.rank = "Beginner";
        }

        function checkDailyStreak() {
            const today = new Date().toDateString();
            if (gameState.lastPlayed !== today) {
                const lastDate = new Date(gameState.lastPlayed);
                const todayDate = new Date(today);
                const diffTime = Math.abs(todayDate - lastDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 1) {
                    gameState.streak++;
                } else if (diffDays > 1) {
                    gameState.streak = 1;
                } else {
                    gameState.streak = 1;
                }
                
                gameState.lastPlayed = today;
                saveGameState();
            }
        }

        function addXP(amount) {
            gameState.totalXP += amount;
            updateMainStats();
            saveGameState();
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // ==================== MINI GAMES MENU ====================
        function showMiniGames() {
            const grid = document.getElementById('miniGameGrid');
            grid.innerHTML = '';
            
            Object.keys(MINIGAMES).forEach(key => {
                const game = MINIGAMES[key];
                const isLocked = gameState.totalXP < game.unlockLevel;
                
                const card = document.createElement('div');
                card.className = `minigame-card ${isLocked ? 'locked' : ''}`;
                card.innerHTML = `
                    <div class="minigame-icon">${game.icon}</div>
                    <div class="minigame-name">${game.name}</div>
                    <div class="minigame-desc">${game.description}</div>
                    <div style="margin-top: 10px; color: #667eea; font-weight: bold;">
                        ${isLocked ? `üîí Unlock at ${game.unlockLevel} XP` : `‚≠ê ${game.xpReward} XP`}
                    </div>
                `;
                
                if (!isLocked) {
                    card.onclick = () => startMiniGame(key);
                }
                
                grid.appendChild(card);
            });
            
            showScreen('miniGamesMenu');
        }

        function startMiniGame(gameKey) {
            switch(gameKey) {
                case 'bugHunter': startBugHunter(); break;
                case 'outputPredictor': startOutputPredictor(); break;
                case 'codeScramble': startCodeScramble(); break;
                case 'treasureHunt': startTreasureHunt(); break;
                case 'dailyQuiz': showDailyQuiz(); break;
                case 'snakeGame': showSnakeGame(); break;
                case 'storyAdventure': startStoryAdventure(); break;
                case 'fileHacker': startFileHacker(); break;
                case 'functionBuilder': startFunctionBuilder(); break;
                case 'rpgBattle': startRPGBattle(); break;
            }
        }

        // ==================== 1. BUG HUNTER ====================
        let bugDifficulty = 'easy';
        let bugScore = 0;
        let bugTimeLeft = 60;

        function setBugDifficulty(diff) {
            bugDifficulty = diff;
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('bugLevel').textContent = diff.charAt(0).toUpperCase() + diff.slice(1);
        }

        function startBugHunter() {
            bugScore = 0;
            bugTimeLeft = 60;
            document.getElementById('bugScore').textContent = bugScore;
            gameState.gameProgress.bugHunter.played++;
            showScreen('bugHunterGame');
            nextBugChallenge();
            startBugTimer();
        }

        function startBugTimer() {
            bugTimer = setInterval(() => {
                bugTimeLeft--;
                document.getElementById('bugTimer').textContent = bugTimeLeft;
                if (bugTimeLeft <= 0) {
                    clearInterval(bugTimer);
                    endBugHunter();
                }
            }, 1000);
        }

        function nextBugChallenge() {
            const challenges = BUG_CHALLENGES[bugDifficulty];
            currentBugChallenge = challenges[Math.floor(Math.random() * challenges.length)];
            
            const codeBlock = document.getElementById('bugCode');
            codeBlock.innerHTML = '';
            
            currentBugChallenge.code.forEach((line, index) => {
                const lineDiv = document.createElement('div');
                lineDiv.className = 'code-line';
                lineDiv.textContent = `${index + 1}  ${line}`;
                lineDiv.onclick = () => checkBugLine(index);
                codeBlock.appendChild(lineDiv);
            });
            
            document.getElementById('bugFeedback').innerHTML = '';
        }

        function checkBugLine(index) {
            const feedback = document.getElementById('bugFeedback');
            if (index === currentBugChallenge.bugLine) {
                bugScore += bugDifficulty === 'easy' ? 10 : bugDifficulty === 'medium' ? 20 : 30;
                document.getElementById('bugScore').textContent = bugScore;
                feedback.innerHTML = `<div class="explanation">‚úÖ Correct! ${currentBugChallenge.explanation}</div>`;
                
                setTimeout(nextBugChallenge, 2000);
            } else {
                feedback.innerHTML = `<div class="explanation" style="background: #f8d7da; border-color: #dc3545;">‚ùå Wrong line! Try again.</div>`;
            }
        }

        function endBugHunter() {
            clearInterval(bugTimer);
            if (bugScore > gameState.gameProgress.bugHunter.highScore) {
                gameState.gameProgress.bugHunter.highScore = bugScore;
            }
            gameState.gameProgress.bugHunter.won++;
            gameState.gamesWon++;
            
            const xpEarned = Math.floor(bugScore / 2);
            addXP(xpEarned);
            
            alert(`üéâ Game Over!\n\nScore: ${bugScore}\nXP Earned: ${xpEarned}`);
            showMiniGames();
        }

        // ==================== 2. OUTPUT PREDICTOR ====================
        let outputScore = 0;
        let outputCorrect = 0;
        let outputTimeLeft = 30;
        let hintsUsed = 0;

        function startOutputPredictor() {
            outputScore = 0;
            outputCorrect = 0;
            outputTimeLeft = 30;
            hintsUsed = 0;
            document.getElementById('outputScore').textContent = outputScore;
            document.getElementById('outputCorrect').textContent = outputCorrect;
            gameState.gameProgress.outputPredictor.played++;
            showScreen('outputPredictorGame');
            nextOutputChallenge();
            startOutputTimer();
        }

        function startOutputTimer() {
            outputTimer = setInterval(() => {
                outputTimeLeft--;
                document.getElementById('outputTimer').textContent = outputTimeLeft;
                if (outputTimeLeft <= 0) {
                    clearInterval(outputTimer);
                    endOutputPredictor();
                }
            }, 1000);
        }

        function nextOutputChallenge() {
            currentOutputChallenge = OUTPUT_CHALLENGES[Math.floor(Math.random() * OUTPUT_CHALLENGES.length)];
            
            const codeBlock = document.getElementById('outputCode');
            codeBlock.innerHTML = currentOutputChallenge.code.map((line, i) => 
                `<div class="code-line">${i + 1}  ${line}</div>`
            ).join('');
            
            const optionsDiv = document.getElementById('outputOptions');
            optionsDiv.innerHTML = '';
            
            currentOutputChallenge.options.forEach(option => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => checkOutput(option);
                optionsDiv.appendChild(optionDiv);
            });
            
            document.getElementById('outputHint').style.display = 'none';
            outputTimeLeft = 30;
        }

        function useHint() {
            if (hintsUsed < 3) {
                document.getElementById('outputHint').innerHTML = `üí° Hint: ${currentOutputChallenge.hint}`;
                document.getElementById('outputHint').style.display = 'block';
                hintsUsed++;
                outputScore -= 5;
                document.getElementById('outputScore').textContent = outputScore;
            } else {
                alert('No more hints available!');
            }
        }

        function checkOutput(selected) {
            const options = document.querySelectorAll('#outputOptions .option');
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            if (selected === currentOutputChallenge.answer) {
                outputScore += 15;
                outputCorrect++;
                document.getElementById('outputScore').textContent = outputScore;
                document.getElementById('outputCorrect').textContent = outputCorrect;
                
                event.target.classList.add('correct');
                setTimeout(nextOutputChallenge, 2000);
            } else {
                event.target.classList.add('wrong');
                options.forEach(opt => {
                    if (opt.textContent === currentOutputChallenge.answer) {
                        opt.classList.add('correct');
                    }
                });
                setTimeout(nextOutputChallenge, 3000);
            }
        }

        function endOutputPredictor() {
            clearInterval(outputTimer);
            if (outputScore > gameState.gameProgress.outputPredictor.highScore) {
                gameState.gameProgress.outputPredictor.highScore = outputScore;
            }
            const xpEarned = outputScore;
            addXP(xpEarned);
            gameState.gamesWon++;
            alert(`üéâ Time's Up!\n\nScore: ${outputScore}\nCorrect: ${outputCorrect}\nXP Earned: ${xpEarned}`);
            showMiniGames();
        }

        // ==================== 3. CODE SCRAMBLE ====================
        let scrambleScore = 0;
        let scrambleTimeLeft = 60;

        function startCodeScramble() {
            scrambleScore = 0;
            scrambleTimeLeft = 60;
            document.getElementById('scrambleScore').textContent = scrambleScore;
            gameState.gameProgress.codeScramble.played++;
            showScreen('codeScrambleGame');
            loadScrambleChallenge();
            startScrambleTimer();
        }

        function startScrambleTimer() {
            scrambleTimer = setInterval(() => {
                scrambleTimeLeft--;
                document.getElementById('scrambleTimer').textContent = scrambleTimeLeft;
                if (scrambleTimeLeft <= 0) {
                    clearInterval(scrambleTimer);
                    alert('‚è∞ Time up! Try again.');
                    showMiniGames();
                }
            }, 1000);
        }

        function loadScrambleChallenge() {
            currentScramble = SCRAMBLE_CHALLENGES[Math.floor(Math.random() * SCRAMBLE_CHALLENGES.length)];
            droppedLines = [];
            
            const scrambled = [...currentScramble.correct].sort(() => Math.random() - 0.5);
            const codeDiv = document.getElementById('scrambleCode');
            codeDiv.innerHTML = `<p style="margin-bottom: 15px;"><strong>Task:</strong> ${currentScramble.description}</p>`;
            
            scrambled.forEach((line, index) => {
                const lineDiv = document.createElement('div');
                lineDiv.className = 'draggable-code';
                lineDiv.draggable = true;
                lineDiv.textContent = line;
                lineDiv.dataset.line = line;
                lineDiv.ondragstart = (e) => e.dataTransfer.setData('text', line);
                codeDiv.appendChild(lineDiv);
            });
            
            const dropZone = document.getElementById('dropZone');
            dropZone.innerHTML = 'Drop lines here in correct order';
            dropZone.ondragover = (e) => e.preventDefault();
            dropZone.ondrop = handleDrop;
        }

        function handleDrop(e) {
            e.preventDefault();
            const line = e.dataTransfer.getData('text');
            if (!droppedLines.includes(line)) {
                droppedLines.push(line);
                updateDropZone();
            }
        }

        function updateDropZone() {
            const dropZone = document.getElementById('dropZone');
            if (droppedLines.length === 0) {
                dropZone.innerHTML = 'Drop lines here in correct order';
            } else {
                dropZone.innerHTML = droppedLines.map((line, i) => 
                    `<div class="draggable-code">${i + 1}. ${line}</div>`
                ).join('');
            }
        }

        function checkScramble() {
            if (droppedLines.length !== currentScramble.correct.length) {
                alert('‚ö†Ô∏è Please arrange all lines first!');
                return;
            }
            
            const isCorrect = droppedLines.every((line, i) => line === currentScramble.correct[i]);
            
            if (isCorrect) {
                clearInterval(scrambleTimer);
                scrambleScore += 100 - (60 - scrambleTimeLeft);
                gameState.gameProgress.codeScramble.won++;
                gameState.gamesWon++;
                const xpEarned = 25 + Math.floor(scrambleTimeLeft / 2);
                addXP(xpEarned);
                alert(`üéâ Perfect!\n\nTime: ${60 - scrambleTimeLeft}s\nXP Earned: ${xpEarned}`);
                showMiniGames();
            } else {
                alert('‚ùå Not quite right! Try again.');
            }
        }

        function resetScramble() {
            droppedLines = [];
            updateDropZone();
        }

        // ==================== 4. TREASURE HUNT ====================
        let treasureLevel = 1;
        let treasuresFound = 0;
        let movesCount = 0;
        let treasurePositions = [];

        function startTreasureHunt() {
            treasureLevel = gameState.gameProgress.treasureHunt.level;
            treasuresFound = 0;
            movesCount = 0;
            document.getElementById('treasuresFound').textContent = treasuresFound;
            document.getElementById('movesCount').textContent = movesCount;
            document.getElementById('treasureLevel').textContent = treasureLevel;
            showScreen('treasureHuntGame');
            createTreasureGrid();
        }

        function createTreasureGrid() {
            const gridSize = 5 + treasureLevel;
            const grid = document.getElementById('treasureGrid');
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = `repeat(${gridSize}, 40px)`;
            
            treasurePositions = [];
            for (let i = 0; i < 3; i++) {
                treasurePositions.push({
                    row: Math.floor(Math.random() * gridSize),
                    col: Math.floor(Math.random() * gridSize)
                });
            }
            
            for (let i = 0; i < gridSize * gridSize; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                cell.textContent = '?';
                cell.dataset.index = i;
                cell.onclick = () => checkTreasureCell(i, gridSize);
                grid.appendChild(cell);
            }
        }

        function checkTreasureCell(index, gridSize) {
            const row = Math.floor(index / gridSize);
            const col = index % gridSize;
            const cell = event.target;
            
            movesCount++;
            document.getElementById('movesCount').textContent = movesCount;
            
            const foundTreasure = treasurePositions.some(pos => pos.row === row && pos.col === col);
            
            if (foundTreasure) {
                cell.textContent = 'üíé';
                cell.classList.add('found');
                cell.onclick = null;
                treasuresFound++;
                document.getElementById('treasuresFound').textContent = treasuresFound;
                
                if (treasuresFound === 3) {
                    const xpEarned = 30 + (treasureLevel * 10);
                    addXP(xpEarned);
                    gameState.gameProgress.treasureHunt.level++;
                    gameState.gamesWon++;
                    alert(`üéâ All treasures found!\n\nMoves: ${movesCount}\nXP Earned: ${xpEarned}\n\nLevel up!`);
                    showMiniGames();
                }
            } else {
                cell.textContent = '‚ùå';
                setTimeout(() => {
                    if (cell.textContent === '‚ùå') cell.textContent = '?';
                }, 1000);
            }
        }

        function executeTreasureCode() {
            const code = document.getElementById('treasureCode').value.trim();
            if (code.includes('for') && code.includes('range')) {
                alert('üí° Good use of loops! This helps you search systematically.');
            } else {
                alert('üí° Tip: Use loops like "for i in range(5):" to search efficiently!');
            }
        }

        // ==================== 5. DAILY QUIZ ====================
        function showDailyQuiz() {
            currentQuizIndex = 0;
            gameState.gameProgress.dailyQuiz.played++;
            const today = new Date().toDateString();
            if (gameState.gameProgress.dailyQuiz.lastDate !== today) {
                gameState.gameProgress.dailyQuiz.streak++;
                gameState.gameProgress.dailyQuiz.lastDate = today;
            }
            document.getElementById('quizStreak').textContent = gameState.gameProgress.dailyQuiz.streak;
            showScreen('dailyQuizGame');
            showQuizQuestion();
        }

        function showQuizQuestion() {
            if (currentQuizIndex >= DAILY_QUIZ.length) {
                const xpEarned = 50;
                addXP(xpEarned);
                gameState.gamesWon++;
                alert(`üéâ Quiz Complete!\n\nXP Earned: ${xpEarned}\nStreak: ${gameState.gameProgress.dailyQuiz.streak} days`);
                showScreen('mainMenu');
                return;
            }
            
            const question = DAILY_QUIZ[currentQuizIndex];
            const container = document.getElementById('quizQuestion');
            container.innerHTML = `
                <h3>Question ${currentQuizIndex + 1} of ${DAILY_QUIZ.length}</h3>
                <p style="font-size: 1.2em; margin: 20px 0;">${question.q}</p>
                <div id="quizOptions"></div>
            `;
            
            const optionsDiv = document.getElementById('quizOptions');
            question.options.forEach(option => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => checkQuizAnswer(option.charAt(0), question);
                optionsDiv.appendChild(optionDiv);
            });
            
            document.getElementById('quizExplanation').innerHTML = '';
            document.getElementById('quizNextBtn').style.display = 'none';
        }

        function checkQuizAnswer(selected, question) {
            const options = document.querySelectorAll('#quizOptions .option');
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            const isCorrect = selected === question.answer;
            const explanationDiv = document.getElementById('quizExplanation');
            
            options.forEach(opt => {
                if (opt.textContent.charAt(0) === question.answer) {
                    opt.classList.add('correct');
                }
                if (opt.textContent.charAt(0) === selected && !isCorrect) {
                    opt.classList.add('wrong');
                }
            });
            
            explanationDiv.innerHTML = `
                <div class="explanation">
                    <strong>${isCorrect ? '‚úÖ Correct!' : '‚ùå Not quite!'}</strong><br>
                    ${question.explanation}
                </div>
            `;
            
            if (isCorrect) addXP(5);
            document.getElementById('quizNextBtn').style.display = 'inline-block';
        }

        function nextQuizQuestion() {
            currentQuizIndex++;
            showQuizQuestion();
        }

        // ==================== 6. SNAKE GAME ====================
        let snake = [];
        let food = {};
        let direction = { x: 1, y: 0 };
        let snakeGameInterval = null;
        let snakeQuestionActive = false;

        function showSnakeGame() {
            showScreen('snakeGame');
        }

        function startSnakeGame() {
            const canvas = document.getElementById('snakeCanvas');
            const ctx = canvas.getContext('2d');
            
            snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
            direction = {x: 1, y: 0};
            placeFood();
            snakeGameRunning = true;
            snakeQuestionActive = false;
            
            document.getElementById('snakeLength').textContent = snake.length;
            document.getElementById('snakeScore').textContent = 0;
            document.getElementById('snakeQuestion').style.display = 'none';
            
            document.addEventListener('keydown', handleSnakeKey);
            
            snakeGameInterval = setInterval(() => {
                if (!snakeQuestionActive) {
                    updateSnake();
                    drawSnake(ctx);
                }
            }, 200);
        }

        function handleSnakeKey(e) {
            if (!snakeGameRunning) return;
            
            switch(e.key) {
                case 'ArrowUp': if (direction.y === 0) direction = {x: 0, y: -1}; break;
                case 'ArrowDown': if (direction.y === 0) direction = {x: 0, y: 1}; break;
                case 'ArrowLeft': if (direction.x === 0) direction = {x: -1, y: 0}; break;
                case 'ArrowRight': if (direction.x === 0) direction = {x: 1, y: 0}; break;
            }
        }

        function updateSnake() {
            const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
            
            if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || 
                snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                endSnakeGame();
                return;
            }
            
            snake.unshift(head);
            
            if (head.x === food.x && head.y === food.y) {
                showSnakeQuestion();
            } else {
                snake.pop();
            }
        }

        function drawSnake(ctx) {
            ctx.fillStyle = '#2d2d2d';
            ctx.fillRect(0, 0, 400, 400);
            
            ctx.fillStyle = '#98c379';
            snake.forEach(segment => {
                ctx.fillRect(segment.x * 20, segment.y * 20, 18, 18);
            });
            
            ctx.fillStyle = '#e06c75';
            ctx.fillRect(food.x * 20, food.y * 20, 18, 18);
        }

        function placeFood() {
            food = {
                x: Math.floor(Math.random() * 20),
                y: Math.floor(Math.random() * 20)
            };
        }

        function showSnakeQuestion() {
            snakeQuestionActive = true;
            const question = DAILY_QUIZ[Math.floor(Math.random() * DAILY_QUIZ.length)];
            
            document.getElementById('snakeQuestion').style.display = 'block';
            const content = document.getElementById('snakeQuizContent');
            content.innerHTML = `
                <h3>üêç Answer to Grow!</h3>
                <p>${question.q}</p>
                <div id="snakeQuizOptions"></div>
            `;
            
            const optionsDiv = document.getElementById('snakeQuizOptions');
            question.options.forEach(option => {
                const btn = document.createElement('div');
                btn.className = 'option';
                btn.textContent = option;
                btn.onclick = () => checkSnakeAnswer(option.charAt(0), question);
                optionsDiv.appendChild(btn);
            });
        }

        function checkSnakeAnswer(selected, question) {
            if (selected === question.answer) {
                document.getElementById('snakeLength').textContent = snake.length;
                const score = parseInt(document.getElementById('snakeScore').textContent);
                document.getElementById('snakeScore').textContent = score + 10;
                addXP(10);
                placeFood();
            } else {
                if (snake.length > 3) snake.pop();
                document.getElementById('snakeLength').textContent = snake.length;
            }
            
            document.getElementById('snakeQuestion').style.display = 'none';
            snakeQuestionActive = false;
        }

        function endSnakeGame() {
            clearInterval(snakeGameInterval);
            snakeGameRunning = false;
            document.removeEventListener('keydown', handleSnakeKey);
            const score = parseInt(document.getElementById('snakeScore').textContent);
            gameState.gamesWon++;
            alert(`üêç Game Over!\n\nFinal Length: ${snake.length}\nScore: ${score}`);
        }

        // ==================== 7. STORY ADVENTURE ====================
        function startStoryAdventure() {
            currentStoryNode = 'start';
            document.getElementById('storyChapter').textContent = 1;
            document.getElementById('storyDecisions').textContent = 0;
            showScreen('storyAdventureGame');
            displayStoryNode();
        }

        function displayStoryNode() {
            const node = STORY_DATA[currentStoryNode];
            const content = document.getElementById('storyContent');
            const choices = document.getElementById('storyChoices');
            
            content.innerHTML = `
                <div class="mentor-message">
                    <p style="font-size: 1.1em;">${node.text}</p>
                </div>
            `;
            
            choices.innerHTML = '';
            
            if (node.choices.length === 0) {
                addXP(35);
                gameState.gamesWon++;
                gameState.gameProgress.storyAdventure.completed = true;
                content.innerHTML += `<div class="explanation">‚úÖ Story Complete! You earned 35 XP!</div>`;
                return;
            }
            
            node.choices.forEach(choice => {
                const choiceDiv = document.createElement('div');
                choiceDiv.className = 'story-choice';
                choiceDiv.innerHTML = `
                    <strong>${choice.text}</strong><br>
                    <code style="color: #666; font-size: 0.9em;">${choice.code}</code>
                `;
                choiceDiv.onclick = () => makeStoryChoice(choice);
                choices.appendChild(choiceDiv);
            });
        }

        function makeStoryChoice(choice) {
            currentStoryNode = choice.next;
            const decisions = parseInt(document.getElementById('storyDecisions').textContent);
            document.getElementById('storyDecisions').textContent = decisions + 1;
            displayStoryNode();
        }

        function restartStory() {
            startStoryAdventure();
        }

        // ==================== 8. FILE HACKER ====================
        let currentFileMission = 0;

        function startFileHacker() {
            currentFileMission = 0;
            document.getElementById('fileMission').textContent = currentFileMission + 1;
            document.getElementById('fileScore').textContent = 0;
            showScreen('fileHackerGame');
            loadFileMission();
        }

        function loadFileMission() {
            const mission = FILE_MISSIONS[currentFileMission];
            const content = document.getElementById('fileMissionContent');
            content.innerHTML = `
                <div class="mentor-message">
                    <h3>${mission.title}</h3>
                    <p>${mission.description}</p>
                </div>
                <div class="hint-box">üí° Hint: ${mission.hint}</div>
            `;
            document.getElementById('fileCode').value = '';
        }

        function executeFileCode() {
            const code = document.getElementById('fileCode').value.trim();
            const mission = FILE_MISSIONS[currentFileMission];
            
            if (code.length > 10) {
                const score = parseInt(document.getElementById('fileScore').textContent);
                document.getElementById('fileScore').textContent = score + 10;
                addXP(5);
                alert('‚úÖ Code executed! (Simulated)');
            } else {
                alert('‚ö†Ô∏è Please write some code first!');
            }
        }

        function nextFileMission() {
            currentFileMission++;
            if (currentFileMission >= FILE_MISSIONS.length) {
                addXP(45);
                gameState.gamesWon++;
                gameState.gameProgress.fileHacker.completed = FILE_MISSIONS.length;
                alert('üéâ All missions complete! You earned 45 XP!');
                showMiniGames();
            } else {
                document.getElementById('fileMission').textContent = currentFileMission + 1;
                loadFileMission();
            }
        }

        // ==================== 9. FUNCTION BUILDER ====================
        let currentFunctionChallenge = 0;

        function startFunctionBuilder() {
            currentFunctionChallenge = 0;
            document.getElementById('funcLevel').textContent = 1;
            document.getElementById('funcScore').textContent = 0;
            document.getElementById('funcCompleted').textContent = 0;
            showScreen('functionBuilderGame');
            loadFunctionChallenge();
        }

        function loadFunctionChallenge() {
            const challenge = FUNCTION_CHALLENGES[currentFunctionChallenge];
            const content = document.getElementById('functionContent');
            content.innerHTML = `
                <div class="mentor-message">
                    <h3>Challenge ${currentFunctionChallenge + 1}</h3>
                    <p>${challenge.description}</p>
                </div>
                <div class="code-block">${challenge.incomplete.replace(/\n/g, '<br>')}</div>
            `;
            document.getElementById('functionCode').value = challenge.incomplete;
        }

        function testFunction() {
            const code = document.getElementById('functionCode').value.trim();
            if (code.includes('return') && code.length > 20) {
                const score = parseInt(document.getElementById('funcScore').textContent);
                document.getElementById('funcScore').textContent = score + 20;
                addXP(10);
                alert('‚úÖ Function looks good! (Test passed)');
            } else {
                alert('‚ö†Ô∏è Complete the return statement!');
            }
        }

        function nextFunctionChallenge() {
            currentFunctionChallenge++;
            if (currentFunctionChallenge >= FUNCTION_CHALLENGES.length) {
                addXP(40);
                gameState.gamesWon++;
                alert('üéâ All functions complete! You earned 40 XP!');
                showMiniGames();
            } else {
                document.getElementById('funcLevel').textContent = currentFunctionChallenge + 1;
                loadFunctionChallenge();
            }
        }

        // ==================== 10. RPG BATTLE ====================
        function startRPGBattle() {
            currentEnemy = 0;
            showScreen('rpgBattleGame');
            loadEnemy();
        }

        function loadEnemy() {
            const enemy = RPG_ENEMIES[currentEnemy];
            document.getElementById('enemyDisplay').textContent = enemy.emoji;
            document.getElementById('enemyName').textContent = enemy.name;
            document.getElementById('enemyHealth').style.width = '100%';
            document.getElementById('enemyHealth').textContent = enemy.hp + ' HP';
            document.getElementById('playerHealth').style.width = '100%';
            document.getElementById('playerHealth').textContent = '100 HP';
            
            showBattleQuestion();
        }

        function showBattleQuestion() {
            const enemy = RPG_ENEMIES[currentEnemy];
            const question = enemy.question;
            
            const container = document.getElementById('battleQuestion');
            container.innerHTML = `
                <h3>‚öîÔ∏è Answer to Attack!</h3>
                <p style="font-size: 1.1em;">${question.q}</p>
                <div id="battleOptions"></div>
            `;
            
            const optionsDiv = document.getElementById('battleOptions');
            question.options.forEach(option => {
                const btn = document.createElement('div');
                btn.className = 'option';
                btn.textContent = option;
                btn.onclick = () => checkBattleAnswer(option.charAt(0), question);
                optionsDiv.appendChild(btn);
            });
        }

        function checkBattleAnswer(selected, question) {
            const options = document.querySelectorAll('#battleOptions .option');
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            const enemy = RPG_ENEMIES[currentEnemy];
            
            if (selected === question.answer) {
                const enemyHealth = document.getElementById('enemyHealth');
                const currentHP = parseInt(enemyHealth.textContent);
                const newHP = Math.max(0, currentHP - 50);
                enemyHealth.style.width = (newHP / enemy.hp * 100) + '%';
                enemyHealth.textContent = newHP + ' HP';
                
                if (newHP === 0) {
                    addXP(60);
                    gameState.gamesWon++;
                    setTimeout(() => {
                        currentEnemy++;
                        if (currentEnemy >= RPG_ENEMIES.length) {
                            alert('üéâ All enemies defeated! You are a Python Master!');
                            showMiniGames();
                        } else {
                            loadEnemy();
                        }
                    }, 1500);
                } else {
                    setTimeout(showBattleQuestion, 1500);
                }
            } else {
                const playerHealth = document.getElementById('playerHealth');
                const currentHP = parseInt(playerHealth.textContent);
                const newHP = Math.max(0, currentHP - 25);
                playerHealth.style.width = newHP + '%';
                playerHealth.textContent = newHP + ' HP';
                
                if (newHP === 0) {
                    alert('üíÄ You were defeated! Try again!');
                    showMiniGames();
                } else {
                    setTimeout(showBattleQuestion, 1500);
                }
            }
        }

        // ==================== STATS & LEADERBOARD ====================
        function showStats() {
            document.getElementById('statsXP').textContent = gameState.totalXP;
            document.getElementById('statsRank').textContent = gameState.rank;
            document.getElementById('statsStreak').textContent = gameState.streak;
            
            const gameStats = document.getElementById('gameStats');
            gameStats.innerHTML = '<h3 style="color: #667eea; margin: 20px 0;">üìä Game Statistics</h3>';
            
            Object.keys(gameState.gameProgress).forEach(key => {
                const game = gameState.gameProgress[key];
                const gameName = key.replace(/([A-Z])/g, ' $1').trim();
                gameStats.innerHTML += `
                    <div class="leaderboard-entry">
                        <strong>${gameName}</strong>
                        <span>Played: ${game.played || 0} | Won: ${game.won || 0}</span>
                    </div>
                `;
            });
            
            showScreen('statsScreen');
        }

        function showLeaderboard() {
            const content = document.getElementById('leaderboardContent');
            content.innerHTML = `
                <div class="mentor-message">
                    <h3>üèÜ Top Players</h3>
                    <p>Your rank: ${gameState.rank} (${gameState.totalXP} XP)</p>
                </div>
                <div class="leaderboard-entry">
                    <strong>1. CodeMaster</strong>
                    <span>2500 XP</span>
                </div>
                <div class="leaderboard-entry">
                    <strong>2. PythonPro</strong>
                    <span>2100 XP</span>
                </div>
                <div class="leaderboard-entry">
                    <strong>3. You!</strong>
                    <span>${gameState.totalXP} XP</span>
                </div>
            `;
            showScreen('leaderboardScreen');
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset ALL progress?')) {
                localStorage.removeItem('propyquest_game_state');
                location.reload();
            }
        }

        // ==================== INITIALIZE ====================
        window.onload = initGame;
    </script>
</body>
</html>